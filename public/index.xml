<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Chuliang Xiao on Chuliang Xiao</title>
    <link>/</link>
    <description>Recent content in Chuliang Xiao on Chuliang Xiao</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>&amp;copy; 2018 Chuliang Xiao</copyright>
    <lastBuildDate>Sun, 15 Oct 2017 00:00:00 -0400</lastBuildDate>
    <atom:link href="/" rel="self" type="application/rss+xml" />
    
    <item>
      <title>A Dynamical Downscaling Projection of Future Climate Change in the Laurentian Great Lakes Region Using a Coupled Air-Lake Model</title>
      <link>/publication/2018-downscaling/</link>
      <pubDate>Thu, 26 Jul 2018 00:00:00 +0000</pubDate>
      
      <guid>/publication/2018-downscaling/</guid>
      <description></description>
    </item>
    
    <item>
      <title>WRF-based assessment of the Great Lakes&#39; impact on cold season synoptic cyclones</title>
      <link>/publication/2018-cyclone/</link>
      <pubDate>Fri, 20 Jul 2018 00:00:00 +0000</pubDate>
      
      <guid>/publication/2018-cyclone/</guid>
      <description></description>
    </item>
    
    <item>
      <title>Change R (Rscript) Windows Environment Path from OneDrive</title>
      <link>/post/change-r-rscript-windows-environment-path-from-onedrive/</link>
      <pubDate>Sun, 01 Jul 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/change-r-rscript-windows-environment-path-from-onedrive/</guid>
      <description>


&lt;div id=&#34;pain-in-the-butt&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;pain in the butt&lt;/h3&gt;
&lt;p&gt;When &lt;strong&gt;OneDrive&lt;/strong&gt; was installed in a computer, it’s painful using R and Rscirpt in command line.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Since the &lt;code&gt;Documents&lt;/code&gt; has been hijacked by &lt;strong&gt;OneDrive&lt;/strong&gt;, whenever you open the directory &lt;code&gt;C:\User\YourName\Documents&lt;/code&gt; it automatically redirects to &lt;code&gt;C:\Users\YourName\OneDrive - Spectrum Health\Documents&lt;/code&gt;. You don’t want to backup 2-GB R library fold to the &lt;strong&gt;OneDrive&lt;/strong&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;How to reach the real &lt;code&gt;C:\User\YourName\Documents&lt;/code&gt; instead of &lt;code&gt;C:\Users\YourName\OneDrive - Spectrum Health\Documents&lt;/code&gt;, you have to go &lt;code&gt;C:&lt;/code&gt; drive, then &lt;code&gt;User&lt;/code&gt; folder, then &lt;code&gt;YourName&lt;/code&gt; folder, then &lt;code&gt;Documents&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;R’s default environemnts
&lt;ul&gt;
&lt;li&gt;Home directory is &lt;code&gt;C:\Users\YourName\OneDrive - Spectrum Health\Documents&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;User library (R_LIBS_USER) is &lt;code&gt;C:\Users\YourName\OneDrive - Spectrum Health\Documents\R\win-lib\R-version&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div id=&#34;change-r-envrionments&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Change &lt;code&gt;R&lt;/code&gt; envrionments&lt;/h3&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;Change &lt;code&gt;.Renvrion&lt;/code&gt; under &lt;code&gt;C:\Users\YourName\OneDrive - Spectrum Health\Documents&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;HOME=C:/Users/YourName
R_USER=C:/Users/YourName
R_LIBS_USER=C:/Users/YourName/Rpackages
R_LIBS=C:/Program Files/R/R-3.5.2/library&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;2&#34; style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;Copy the above &lt;code&gt;.Renvrion&lt;/code&gt; to &lt;code&gt;C:\User\YourName\&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div id=&#34;change-rscript-envrionments&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Change &lt;code&gt;Rscript&lt;/code&gt; envrionments&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;In command line, set the following PATHs before &lt;code&gt;Rsciprt R_Script.R&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;set HOME=C:/Users/YourName
set R_USER=C:/Users/YourName
set R_LIBS_USER=C:/Users/YourName/Rpackages
Rsciprt R_Script.R&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;In &lt;a href=&#34;https://docs.microsoft.com/en-us/windows/desktop/taskschd/task-scheduler-start-page&#34;&gt;Task Scheduler&lt;/a&gt; of &lt;a href=&#34;https://en.wikipedia.org/wiki/Batch_file&#34;&gt;.bat&lt;/a&gt; file&lt;br /&gt;
Same as command line, those PATHs must be set before &lt;code&gt;Rsciprt R_Script.R&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;Google Analytics authentication&lt;br /&gt;
Add &lt;code&gt;ga_auth(token = &#34;C:/Users/CHU83456/.httr-oauth&#34;)&lt;/code&gt; in your &lt;code&gt;R_Script.R&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Add password to root MySQL on Mac (brew)</title>
      <link>/post/add-password-to-root-mysql-on-mac-brew/</link>
      <pubDate>Tue, 19 Jun 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/add-password-to-root-mysql-on-mac-brew/</guid>
      <description>


&lt;pre&gt;&lt;code&gt;ERROR! The server quit without updating PID file&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;A: Try &lt;code&gt;brew services start mysql&lt;/code&gt;&lt;br /&gt;
Credit to &lt;a href=&#34;https://stackoverflow.com/a/50210425/9421451&#34;&gt;StackOverflow&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;Table &amp;#39;mysql.role_edges&amp;#39; doesn&amp;#39;t exist&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;A: Try &lt;code&gt;mysql_upgrade -u root&lt;/code&gt;&lt;br /&gt;
Credit to &lt;a href=&#34;https://stackoverflow.com/a/51214393/9421451&#34;&gt;StackOverflow&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;Access denied for user &amp;#39;root&amp;#39;@&amp;#39;localhost&amp;#39; (using password: NO)&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;A: Try &lt;code&gt;mysql_secure_installation&lt;/code&gt; and follow instruction to setup new password.&lt;br /&gt;
Credit to &lt;a href=&#34;https://stackoverflow.com/a/46194427/9421451&#34;&gt;StackOverflow&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Sparse Matrix and Dummy Variables</title>
      <link>/post/sparse-matrix-and-dummy-variables/</link>
      <pubDate>Tue, 05 Jun 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/sparse-matrix-and-dummy-variables/</guid>
      <description>


&lt;div id=&#34;why-sparse-matrix&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Why sparse matrix?&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;XGBoost&lt;/code&gt; only works with matrices that contain &lt;strong&gt;all numeric&lt;/strong&gt; variables; consequently, we need to one-hot encode our data. (&lt;a href=&#34;http://uc-r.github.io/gbm_regression&#34;&gt;UC Business Analytics R Programming Guide&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;caret::preProcess&lt;/code&gt; uses bagging regression trees for missing values recovery (&lt;a href=&#34;https://rpubs.com/geka/BagImput_air&#34;&gt;Yevhen Vasylenko&lt;/a&gt;), which requires &lt;strong&gt;all numeric&lt;/strong&gt; variables.&lt;br /&gt;
&lt;/li&gt;
&lt;li&gt;There are different ways to do this in R.&lt;/li&gt;
&lt;/ul&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(tidyverse)
dd &amp;lt;- data.frame(a = gl(3,4), 
                 b = gl(4,1,12), 
                 c = 1:12, 
                 d = sample(c(&amp;quot;X&amp;quot;, &amp;quot;Y&amp;quot;, &amp;quot;Z&amp;quot;), 12, replace = TRUE))
str(dd)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## &amp;#39;data.frame&amp;#39;:    12 obs. of  4 variables:
##  $ a: Factor w/ 3 levels &amp;quot;1&amp;quot;,&amp;quot;2&amp;quot;,&amp;quot;3&amp;quot;: 1 1 1 1 2 2 2 2 3 3 ...
##  $ b: Factor w/ 4 levels &amp;quot;1&amp;quot;,&amp;quot;2&amp;quot;,&amp;quot;3&amp;quot;,&amp;quot;4&amp;quot;: 1 2 3 4 1 2 3 4 1 2 ...
##  $ c: int  1 2 3 4 5 6 7 8 9 10 ...
##  $ d: Factor w/ 3 levels &amp;quot;X&amp;quot;,&amp;quot;Y&amp;quot;,&amp;quot;Z&amp;quot;: 1 1 3 2 1 1 3 1 3 1 ...&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The above data frame contains 4 columns (variables): 3 factor and 1 numeric. Multiple packages in R have similar functions on generating sparse matrix or dummy variables.&lt;/p&gt;
&lt;div id=&#34;basemodel.matrix&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;&lt;code&gt;base::model.matrix&lt;/code&gt;&lt;/h4&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;(mm0 &amp;lt;- model.matrix(~ . , data = dd))&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    (Intercept) a2 a3 b2 b3 b4  c dY dZ
## 1            1  0  0  0  0  0  1  0  0
## 2            1  0  0  1  0  0  2  0  0
## 3            1  0  0  0  1  0  3  0  1
## 4            1  0  0  0  0  1  4  1  0
## 5            1  1  0  0  0  0  5  0  0
## 6            1  1  0  1  0  0  6  0  0
## 7            1  1  0  0  1  0  7  0  1
## 8            1  1  0  0  0  1  8  0  0
## 9            1  0  1  0  0  0  9  0  1
## 10           1  0  1  1  0  0 10  0  0
## 11           1  0  1  0  1  0 11  0  0
## 12           1  0  1  0  0  1 12  0  1
## attr(,&amp;quot;assign&amp;quot;)
## [1] 0 1 1 2 2 2 3 4 4
## attr(,&amp;quot;contrasts&amp;quot;)
## attr(,&amp;quot;contrasts&amp;quot;)$a
## [1] &amp;quot;contr.treatment&amp;quot;
## 
## attr(,&amp;quot;contrasts&amp;quot;)$b
## [1] &amp;quot;contr.treatment&amp;quot;
## 
## attr(,&amp;quot;contrasts&amp;quot;)$d
## [1] &amp;quot;contr.treatment&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;(mm1 &amp;lt;- model.matrix(~ . -1, data = dd)) # no intercept&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    a1 a2 a3 b2 b3 b4  c dY dZ
## 1   1  0  0  0  0  0  1  0  0
## 2   1  0  0  1  0  0  2  0  0
## 3   1  0  0  0  1  0  3  0  1
## 4   1  0  0  0  0  1  4  1  0
## 5   0  1  0  0  0  0  5  0  0
## 6   0  1  0  1  0  0  6  0  0
## 7   0  1  0  0  1  0  7  0  1
## 8   0  1  0  0  0  1  8  0  0
## 9   0  0  1  0  0  0  9  0  1
## 10  0  0  1  1  0  0 10  0  0
## 11  0  0  1  0  1  0 11  0  0
## 12  0  0  1  0  0  1 12  0  1
## attr(,&amp;quot;assign&amp;quot;)
## [1] 1 1 1 2 2 2 3 4 4
## attr(,&amp;quot;contrasts&amp;quot;)
## attr(,&amp;quot;contrasts&amp;quot;)$a
## [1] &amp;quot;contr.treatment&amp;quot;
## 
## attr(,&amp;quot;contrasts&amp;quot;)$b
## [1] &amp;quot;contr.treatment&amp;quot;
## 
## attr(,&amp;quot;contrasts&amp;quot;)$d
## [1] &amp;quot;contr.treatment&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;#if only applied to one column
head(mm2 &amp;lt;- model.matrix(~ a , data = dd)) &lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##   (Intercept) a2 a3
## 1           1  0  0
## 2           1  0  0
## 3           1  0  0
## 4           1  0  0
## 5           1  1  0
## 6           1  1  0&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;head(mm3 &amp;lt;- model.matrix(~ a -1, data = dd)) # no intercept&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##   a1 a2 a3
## 1  1  0  0
## 2  1  0  0
## 3  1  0  0
## 4  1  0  0
## 5  0  1  0
## 6  0  1  0&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;matrixsparse.model.matrix&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;&lt;code&gt;Matrix::sparse.model.matrix&lt;/code&gt;&lt;/h4&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;sm1 &amp;lt;- Matrix::sparse.model.matrix(~ . -1, data = dd)
str(sm1)  #class &amp;#39;dgCMatrix&amp;#39;&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Formal class &amp;#39;dgCMatrix&amp;#39; [package &amp;quot;Matrix&amp;quot;] with 6 slots
##   ..@ i       : int [1:38] 0 1 2 3 4 5 6 7 8 9 ...
##   ..@ p       : int [1:10] 0 4 8 12 15 18 21 33 34 38
##   ..@ Dim     : int [1:2] 12 9
##   ..@ Dimnames:List of 2
##   .. ..$ : chr [1:12] &amp;quot;1&amp;quot; &amp;quot;2&amp;quot; &amp;quot;3&amp;quot; &amp;quot;4&amp;quot; ...
##   .. ..$ : chr [1:9] &amp;quot;a1&amp;quot; &amp;quot;a2&amp;quot; &amp;quot;a3&amp;quot; &amp;quot;b2&amp;quot; ...
##   ..@ x       : num [1:38] 1 1 1 1 1 1 1 1 1 1 ...
##   ..@ factors : list()&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;(sm2 &amp;lt;- Matrix::sparse.model.matrix(~ a -1, data = dd))&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 12 x 3 sparse Matrix of class &amp;quot;dgCMatrix&amp;quot;
##    a1 a2 a3
## 1   1  .  .
## 2   1  .  .
## 3   1  .  .
## 4   1  .  .
## 5   .  1  .
## 6   .  1  .
## 7   .  1  .
## 8   .  1  .
## 9   .  .  1
## 10  .  .  1
## 11  .  .  1
## 12  .  .  1&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;matrixmodelsmodel.matrix&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;&lt;code&gt;MatrixModels::model.Matrix&lt;/code&gt;&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;model.Matrix&lt;/code&gt; is a simple wrapper around the traditional &lt;code&gt;model.matrix&lt;/code&gt; and returns a &lt;em&gt;ddenseModelMatrix&lt;/em&gt; object.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;rm1 &amp;lt;- MatrixModels::model.Matrix(~ . -1, data = dd)
str(rm1)  #class &amp;#39;ddenseModelMatrix&amp;#39;&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Formal class &amp;#39;ddenseModelMatrix&amp;#39; [package &amp;quot;MatrixModels&amp;quot;] with 6 slots
##   ..@ x        : num [1:108] 1 1 1 1 0 0 0 0 0 0 ...
##   ..@ Dim      : int [1:2] 12 9
##   ..@ Dimnames :List of 2
##   .. ..$ : chr [1:12] &amp;quot;1&amp;quot; &amp;quot;2&amp;quot; &amp;quot;3&amp;quot; &amp;quot;4&amp;quot; ...
##   .. ..$ : chr [1:9] &amp;quot;a1&amp;quot; &amp;quot;a2&amp;quot; &amp;quot;a3&amp;quot; &amp;quot;b2&amp;quot; ...
##   ..@ factors  : list()
##   ..@ assign   : int [1:9] 1 1 1 2 2 2 3 4 4
##   ..@ contrasts:List of 3
##   .. ..$ a: chr &amp;quot;contr.treatment&amp;quot;
##   .. ..$ b: chr &amp;quot;contr.treatment&amp;quot;
##   .. ..$ d: chr &amp;quot;contr.treatment&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;(rm2 &amp;lt;- MatrixModels::model.Matrix(~ a -1, data = dd))&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 12 x 3 Matrix of class &amp;quot;ddenseModelMatrix&amp;quot;
##    a1 a2 a3
## 1   1  0  0
## 2   1  0  0
## 3   1  0  0
## 4   1  0  0
## 5   0  1  0
## 6   0  1  0
## 7   0  1  0
## 8   0  1  0
## 9   0  0  1
## 10  0  0  1
## 11  0  0  1
## 12  0  0  1&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;caretdummyvars&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;&lt;code&gt;caret::dummyVars&lt;/code&gt;&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(caret)
dummy.vars &amp;lt;- dummyVars(~ . , data = dd)
str(dummy.vars)  #dummyVars list&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## List of 9
##  $ call      : language dummyVars.default(formula = ~., data = dd)
##  $ form      :Class &amp;#39;formula&amp;#39;  language ~.
##   .. ..- attr(*, &amp;quot;.Environment&amp;quot;)=&amp;lt;environment: R_GlobalEnv&amp;gt; 
##  $ vars      : chr [1:4] &amp;quot;a&amp;quot; &amp;quot;b&amp;quot; &amp;quot;c&amp;quot; &amp;quot;d&amp;quot;
##  $ facVars   : chr [1:3] &amp;quot;a&amp;quot; &amp;quot;b&amp;quot; &amp;quot;d&amp;quot;
##  $ lvls      :List of 3
##   ..$ a: chr [1:3] &amp;quot;1&amp;quot; &amp;quot;2&amp;quot; &amp;quot;3&amp;quot;
##   ..$ b: chr [1:4] &amp;quot;1&amp;quot; &amp;quot;2&amp;quot; &amp;quot;3&amp;quot; &amp;quot;4&amp;quot;
##   ..$ d: chr [1:3] &amp;quot;X&amp;quot; &amp;quot;Y&amp;quot; &amp;quot;Z&amp;quot;
##  $ sep       : chr &amp;quot;.&amp;quot;
##  $ terms     :Classes &amp;#39;terms&amp;#39;, &amp;#39;formula&amp;#39;  language ~a + b + c + d
##   .. ..- attr(*, &amp;quot;variables&amp;quot;)= language list(a, b, c, d)
##   .. ..- attr(*, &amp;quot;factors&amp;quot;)= int [1:4, 1:4] 1 0 0 0 0 1 0 0 0 0 ...
##   .. .. ..- attr(*, &amp;quot;dimnames&amp;quot;)=List of 2
##   .. .. .. ..$ : chr [1:4] &amp;quot;a&amp;quot; &amp;quot;b&amp;quot; &amp;quot;c&amp;quot; &amp;quot;d&amp;quot;
##   .. .. .. ..$ : chr [1:4] &amp;quot;a&amp;quot; &amp;quot;b&amp;quot; &amp;quot;c&amp;quot; &amp;quot;d&amp;quot;
##   .. ..- attr(*, &amp;quot;term.labels&amp;quot;)= chr [1:4] &amp;quot;a&amp;quot; &amp;quot;b&amp;quot; &amp;quot;c&amp;quot; &amp;quot;d&amp;quot;
##   .. ..- attr(*, &amp;quot;order&amp;quot;)= int [1:4] 1 1 1 1
##   .. ..- attr(*, &amp;quot;intercept&amp;quot;)= int 1
##   .. ..- attr(*, &amp;quot;response&amp;quot;)= int 0
##   .. ..- attr(*, &amp;quot;.Environment&amp;quot;)=&amp;lt;environment: R_GlobalEnv&amp;gt; 
##   .. ..- attr(*, &amp;quot;predvars&amp;quot;)= language list(a, b, c, d)
##   .. ..- attr(*, &amp;quot;dataClasses&amp;quot;)= Named chr [1:4] &amp;quot;factor&amp;quot; &amp;quot;factor&amp;quot; &amp;quot;numeric&amp;quot; &amp;quot;factor&amp;quot;
##   .. .. ..- attr(*, &amp;quot;names&amp;quot;)= chr [1:4] &amp;quot;a&amp;quot; &amp;quot;b&amp;quot; &amp;quot;c&amp;quot; &amp;quot;d&amp;quot;
##  $ levelsOnly: logi FALSE
##  $ fullRank  : logi FALSE
##  - attr(*, &amp;quot;class&amp;quot;)= chr &amp;quot;dummyVars&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dd.dummy   &amp;lt;- predict(dummy.vars, dd)
dd.dummy  # numeric matrix&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    a.1 a.2 a.3 b.1 b.2 b.3 b.4  c d.X d.Y d.Z
## 1    1   0   0   1   0   0   0  1   1   0   0
## 2    1   0   0   0   1   0   0  2   1   0   0
## 3    1   0   0   0   0   1   0  3   0   0   1
## 4    1   0   0   0   0   0   1  4   0   1   0
## 5    0   1   0   1   0   0   0  5   1   0   0
## 6    0   1   0   0   1   0   0  6   1   0   0
## 7    0   1   0   0   0   1   0  7   0   0   1
## 8    0   1   0   0   0   0   1  8   1   0   0
## 9    0   0   1   1   0   0   0  9   0   0   1
## 10   0   0   1   0   1   0   0 10   1   0   0
## 11   0   0   1   0   0   1   0 11   1   0   0
## 12   0   0   1   0   0   0   1 12   0   0   1&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;basemodel.matrix-1&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;&lt;code&gt;base::model.matrix&lt;/code&gt;&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;mm.dummy &amp;lt;- cbind(model.matrix(~ a - 1, data = dd),
                  model.matrix(~ b - 1, data = dd),
                  c = dd[, &amp;quot;c&amp;quot;],
                  model.matrix(~ d - 1, data = dd)
                  )
mm.dummy&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    a1 a2 a3 b1 b2 b3 b4  c dX dY dZ
## 1   1  0  0  1  0  0  0  1  1  0  0
## 2   1  0  0  0  1  0  0  2  1  0  0
## 3   1  0  0  0  0  1  0  3  0  0  1
## 4   1  0  0  0  0  0  1  4  0  1  0
## 5   0  1  0  1  0  0  0  5  1  0  0
## 6   0  1  0  0  1  0  0  6  1  0  0
## 7   0  1  0  0  0  1  0  7  0  0  1
## 8   0  1  0  0  0  0  1  8  1  0  0
## 9   0  0  1  1  0  0  0  9  0  0  1
## 10  0  0  1  0  1  0  0 10  1  0  0
## 11  0  0  1  0  0  1  0 11  1  0  0
## 12  0  0  1  0  0  0  1 12  0  0  1&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Database with R: PostgreSQL</title>
      <link>/post/database-with-r-postgresql/</link>
      <pubDate>Wed, 30 May 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/database-with-r-postgresql/</guid>
      <description>


&lt;div id=&#34;load-library&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Load library&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(tidyverse)
library(RPostgres)
library(DBI)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;connect-to-postgresql&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Connect to &lt;strong&gt;PostgreSQL&lt;/strong&gt;&lt;/h2&gt;
&lt;div id=&#34;connect-method-1-with-rpostgres&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Connect Method 1 with &lt;code&gt;RPostgres&lt;/code&gt;&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;con1 &amp;lt;- DBI::dbConnect(RPostgres::Postgres(), 
                      dbname = &amp;quot;testdb1&amp;quot;,
                      password = rstudioapi::askForPassword(&amp;quot;Database password&amp;quot;))

dbListTables(con1)
#dbWriteTable(con1, &amp;quot;mtcars&amp;quot;, mtcars)
#dbWriteTable(con1, &amp;quot;flights&amp;quot;, nycflights13::flights)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;rstudioapi::askForPassword&lt;/code&gt; requires the password input&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;In the command line (or block-run), there will be popout dialog to input password,&lt;br /&gt;
&lt;/li&gt;
&lt;li&gt;In the knit mode, &lt;code&gt;render&lt;/code&gt; the RMarkdown file as follows:&lt;br /&gt;
&lt;code&gt;rmarkdown::render(&amp;quot;MyDocument.Rmd&amp;quot;, params = &amp;quot;ask&amp;quot;)&lt;/code&gt;&lt;br /&gt;
See &lt;a href=&#34;https://rmarkdown.rstudio.com/developer_parameterized_reports.html#parameter_user_interfaces&#34;&gt;Parameter User Interfaces&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;In the &lt;code&gt;blogdown&lt;/code&gt;, &lt;code&gt;server_site&lt;/code&gt; will halt at the above block.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div id=&#34;connect-method-2-with-rpostgresql&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Connect Method 2 with &lt;code&gt;RPostgreSQL&lt;/code&gt;&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(RPostgreSQL)
drv &amp;lt;- dbDriver(&amp;quot;PostgreSQL&amp;quot;)
con2 &amp;lt;- dbConnect(drv, 
                 host = &amp;quot;localhost&amp;quot;,
                 dbname = &amp;quot;testdb1&amp;quot;,
                 user = &amp;quot;cxiao&amp;quot;,
                 password = rstudioapi::askForPassword(&amp;quot;Database password&amp;quot;))
dbListTables(con2)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;connect-method-3-with-rpostgres-and-config.yml&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Connect Method 3 with &lt;code&gt;RPostgres&lt;/code&gt; and &lt;code&gt;config.yml&lt;/code&gt;&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;Sys.setenv(R_CONFIG_ACTIVE = &amp;quot;AWS&amp;quot;)
dw &amp;lt;- config::get(file = &amp;quot;config.yml&amp;quot;, &amp;quot;dw&amp;quot;)

conAWS1 &amp;lt;- dbConnect(RPostgres::Postgres(),
                     dbname   = dw$database,
                     user      = dw$uid,
                     password = dw$pwd,
                     host     = dw$server,
                     port     = 5432)
dbListTables(conAWS1)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;connect-method-4-with-odbc-and-config.yml&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Connect Method 4 with &lt;code&gt;odbc&lt;/code&gt; and &lt;code&gt;config.yml&lt;/code&gt;&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;conAWS2 &amp;lt;- dbConnect(odbc::odbc(),
                     driver   = dw$driver,
                     database = dw$database,
                     uid      = dw$uid,
                     pwd      = dw$pwd,
                     server   = dw$server,
                     port     = 5432)

dbListTables(conAWS1)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;connect-method-5-with-odbc-and-dsn-configuraton&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Connect Method 5 with &lt;code&gt;odbc&lt;/code&gt; and DSN configuraton&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;conAWS3 &amp;lt;- dbConnect(odbc::odbc(), &amp;quot;AWSPostgreSQL&amp;quot;)
dbListTables(conAWS3)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;query-methods&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Query Methods&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(DBI)
con3 &amp;lt;- dbConnect(odbc::odbc(), &amp;quot;PostgreSQL&amp;quot;)
dbListTables(con3)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;flights&amp;quot;   &amp;quot;mall_sale&amp;quot; &amp;quot;mtcars&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;sql-etl&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;SQL ETL&lt;/h3&gt;
&lt;pre class=&#34;sql&#34;&gt;&lt;code&gt;SELECT * FROM mtcars LIMIT 10&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;knitsql-table&#34;&gt;
&lt;table&gt;
&lt;caption&gt;&lt;span id=&#34;tab:unnamed-chunk-3&#34;&gt;Table 1: &lt;/span&gt;Displaying records 1 - 10&lt;/caption&gt;
&lt;thead&gt;
&lt;tr class=&#34;header&#34;&gt;
&lt;th align=&#34;right&#34;&gt;mpg&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;cyl&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;disp&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;hp&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;drat&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;wt&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;qsec&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;vs&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;am&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;gear&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;carb&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;right&#34;&gt;21.0&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;6&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;160.0&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;110&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;3.90&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;2.620&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;16.46&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;4&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;right&#34;&gt;21.0&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;6&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;160.0&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;110&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;3.90&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;2.875&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;17.02&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;4&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;right&#34;&gt;22.8&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;4&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;108.0&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;93&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;3.85&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;2.320&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;18.61&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;4&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;right&#34;&gt;21.4&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;6&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;258.0&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;110&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;3.08&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;3.215&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;19.44&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;right&#34;&gt;18.7&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;360.0&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;175&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;3.15&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;3.440&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;17.02&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;right&#34;&gt;18.1&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;6&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;225.0&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;105&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;2.76&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;3.460&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;20.22&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;right&#34;&gt;14.3&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;360.0&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;245&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;3.21&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;3.570&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;15.84&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;3&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;right&#34;&gt;24.4&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;4&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;146.7&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;62&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;3.69&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;3.190&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;20.00&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;4&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;right&#34;&gt;22.8&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;4&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;140.8&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;95&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;3.92&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;3.150&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;22.90&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;4&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;right&#34;&gt;19.2&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;6&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;167.6&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;123&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;3.92&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;3.440&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;18.30&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;4&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;sql-in-r&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;SQL in R&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dbGetQuery(con3, &amp;quot;SELECT * FROM mtcars LIMIT 10&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##     mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## 1  21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## 2  21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## 3  22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
## 4  21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
## 5  18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
## 6  18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
## 7  14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
## 8  24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
## 9  22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
## 10 19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;dplyr-query-baced-by-dbplyr&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;&lt;code&gt;dplyr&lt;/code&gt; query baced by &lt;code&gt;dbplyr&lt;/code&gt;&lt;/h3&gt;
&lt;div id=&#34;example-1&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;example 1&lt;/h4&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;mtcars_db &amp;lt;- tbl(con3, &amp;quot;mtcars&amp;quot;)

top2 &amp;lt;- mtcars_db %&amp;gt;% 
  group_by(cyl) %&amp;gt;%
# slice not working for database 
  filter(between(row_number(), 1, 2)) &lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;example-2&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;example 2&lt;/h4&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;flights_db &amp;lt;- tbl(con3, &amp;quot;flights&amp;quot;)

flights_db&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # Source:   table&amp;lt;flights&amp;gt; [?? x 19]
## # Database: postgres [cxiao@localhost:/testdb1]
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with more rows, and 12 more variables: sched_arr_time &amp;lt;int&amp;gt;,
## #   arr_delay &amp;lt;dbl&amp;gt;, carrier &amp;lt;chr&amp;gt;, flight &amp;lt;int&amp;gt;, tailnum &amp;lt;chr&amp;gt;,
## #   origin &amp;lt;chr&amp;gt;, dest &amp;lt;chr&amp;gt;, air_time &amp;lt;dbl&amp;gt;, distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;,
## #   minute &amp;lt;dbl&amp;gt;, time_hour &amp;lt;dttm&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;flights_db %&amp;gt;% 
  tally()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # Source:   lazy query [?? x 1]
## # Database: postgres [cxiao@localhost:/testdb1]
##   n              
##   &amp;lt;S3: integer64&amp;gt;
## 1 336776&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Time Series Analysis II: zoo</title>
      <link>/post/time-series-analysis-ii-zoo/</link>
      <pubDate>Thu, 10 May 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/time-series-analysis-ii-zoo/</guid>
      <description>


&lt;p&gt;&lt;a href=&#34;https://cran.r-project.org/web/packages/zoo/&#34;&gt;&lt;strong&gt;zoo&lt;/strong&gt;&lt;/a&gt;: S3 Infrastructure for Regular and Irregular Time Series (Z’s Ordered Observations)&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;An S3 class with methods for totally ordered indexed observations. It is particularly aimed at irregular time series of numeric vectors/matrices and factors. zoo’s key design goals are independence of a particular index/date/time class and consistency with ts and base R by providing methods to extend standard generics&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div id=&#34;base-time-series-objects-statsts&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Base Time-Series Objects &lt;code&gt;stats::ts&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;Credit: &lt;em&gt;Time Series Analysis in R Part 1: The Time Series Object&lt;/em&gt; by &lt;a href=&#34;https://datascienceplus.com/time-series-analysis-in-r-part-1-the-time-series-object/&#34;&gt;DataSciencePlus&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;From the base &lt;code&gt;ts&lt;/code&gt; objects to a whole host of other packages like &lt;code&gt;xts&lt;/code&gt;, &lt;code&gt;zoo&lt;/code&gt;, &lt;code&gt;TTR&lt;/code&gt;, &lt;code&gt;forecast&lt;/code&gt;, &lt;code&gt;quantmod&lt;/code&gt; and &lt;code&gt;tidyquant&lt;/code&gt;, R has a large infrastructure supporting time series analysis.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div id=&#34;monthlyquaterly-ts&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;Monthly/Quaterly TS&lt;/h4&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ts1 &amp;lt;- ts(1:10, frequency = 12, start = c(1959, 2)) # Feburary of 1959
ts1; class(ts1)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##      Feb Mar Apr May Jun Jul Aug Sep Oct Nov
## 1959   1   2   3   4   5   6   7   8   9  10&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;ts&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ts2 &amp;lt;- ts(1:10, frequency = 4, start = c(1959, 2)) # 2nd Quarter of 1959
ts2&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##      Qtr1 Qtr2 Qtr3 Qtr4
## 1959         1    2    3
## 1960    4    5    6    7
## 1961    8    9   10&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;period-ts&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;Period TS&lt;/h4&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ts3 &amp;lt;- ts(1:10, frequency = 7, start = c(2012, 2))
print(ts3, calendar = TRUE)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##      p1 p2 p3 p4 p5 p6 p7
## 2012     1  2  3  4  5  6
## 2013  7  8  9 10&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;plot-ts&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;Plot TS&lt;/h4&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;gnp &amp;lt;- ts(cumsum(1 + round(rnorm(100), 2)),
          start = c(1954, 7), frequency = 12)
plot(gnp) # using &amp;#39;plot.ts&amp;#39; for time-series plot&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;zoo-class&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;&lt;code&gt;zoo&lt;/code&gt; class&lt;/h3&gt;
&lt;div id=&#34;read-vector-with-a-time-index&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;Read vector with a time index&lt;/h4&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(zoo)
f1 &amp;lt;- system.file(&amp;#39;doc/demo1.txt&amp;#39;, package = &amp;#39;zoo&amp;#39;)
system(paste0(&amp;quot;head &amp;quot;, f1))
inrusd &amp;lt;- read.zoo(f1, sep = &amp;quot;|&amp;quot;, format=&amp;quot;%d %b %Y&amp;quot;)
class(inrusd)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;zoo&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str(inrusd)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## &amp;#39;zoo&amp;#39; series from 2005-02-10 to 2005-03-10
##   Data: num [1:20] 43.8 43.8 43.7 43.8 43.8 ...
##   Index:  Date[1:20], format: &amp;quot;2005-02-10&amp;quot; &amp;quot;2005-02-11&amp;quot; &amp;quot;2005-02-14&amp;quot; &amp;quot;2005-02-15&amp;quot; &amp;quot;2005-02-16&amp;quot; ...&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;head(inrusd)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 2005-02-10 2005-02-11 2005-02-14 2005-02-15 2005-02-16 2005-02-17 
##      43.78      43.79      43.72      43.76      43.82      43.74&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;read-matrix-with-a-time-index&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;Read matrix with a time index&lt;/h4&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;f2 &amp;lt;- system.file(&amp;#39;doc/demo2.txt&amp;#39;, package = &amp;#39;zoo&amp;#39;)
tmp &amp;lt;- read.table(f2, sep = &amp;quot;,&amp;quot;)
z &amp;lt;- zoo(tmp[, 3:4], as.Date(as.character(tmp[, 2]), format=&amp;quot;%d %b %Y&amp;quot;))
colnames(z) &amp;lt;- c(&amp;quot;Nifty&amp;quot;, &amp;quot;Junior&amp;quot;)

head(z)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##              Nifty  Junior
## 2005-02-10 2063.35 4379.20
## 2005-02-11 2082.05 4382.90
## 2005-02-14 2098.25 4391.15
## 2005-02-15 2089.95 4367.25
## 2005-02-17 2061.90 4320.15
## 2005-02-18 2055.55 4318.15&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;convert-back-to-matrix&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;Convert back to matrix&lt;/h4&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plain1 &amp;lt;- coredata(z)
head(plain1)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##        Nifty  Junior
## [1,] 2063.35 4379.20
## [2,] 2082.05 4382.90
## [3,] 2098.25 4391.15
## [4,] 2089.95 4367.25
## [5,] 2061.90 4320.15
## [6,] 2055.55 4318.15&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# with rownames
plain2 &amp;lt;- as.matrix(z)
head(plain2)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##              Nifty  Junior
## 2005-02-10 2063.35 4379.20
## 2005-02-11 2082.05 4382.90
## 2005-02-14 2098.25 4391.15
## 2005-02-15 2089.95 4367.25
## 2005-02-17 2061.90 4320.15
## 2005-02-18 2055.55 4318.15&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;selecting-subsetting&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;Selecting (subsetting)&lt;/h4&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;window(z, start = as.Date(&amp;quot;2005-02-15&amp;quot;), end = as.Date(&amp;quot;2005-02-28&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##              Nifty  Junior
## 2005-02-15 2089.95 4367.25
## 2005-02-17 2061.90 4320.15
## 2005-02-18 2055.55 4318.15
## 2005-02-21 2043.20 4262.25
## 2005-02-22 2058.40 4326.10
## 2005-02-23 2057.10 4346.00
## 2005-02-24 2055.30 4337.00
## 2005-02-25 2060.90 4305.75
## 2005-02-28 2103.25 4388.20&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;z[as.Date(&amp;quot;2005-03-10&amp;quot;)]&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##             Nifty  Junior
## 2005-03-10 2167.4 4648.05&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;missing-value&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;Missing Value&lt;/h4&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# only rows with data from both x and y are included in the output
m1 &amp;lt;- merge(inrusd, z, all = FALSE)
plot(m1)&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# then extra rows will be added to the output with missing values
m2 &amp;lt;- merge(inrusd, z)
plot(m2)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2018-05-10-time-series-analysis-ii-zoo_files/figure-html/unnamed-chunk-7-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;m_approx &amp;lt;- na.approx(m2)# Replaced by linear interpolation via approx 
m_locf   &amp;lt;- na.locf(m2)  # Last Observation Carried Forward&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;plot&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;Plot&lt;/h4&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(ggplot2)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Warning: package &amp;#39;ggplot2&amp;#39; was built under R version 3.5.1&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;x.Date  &amp;lt;- as.Date(paste(2003, 02, c(1, 3, 7, 9, 14), sep = &amp;quot;-&amp;quot;))
x       &amp;lt;- zoo(rnorm(5), x.Date)
xlow    &amp;lt;- x - runif(5)
xhigh   &amp;lt;- x + runif(5)
#z       &amp;lt;- cbind(x, xlow, xhigh)

## univariate plotting
## calling ggplot2.zoo
## autoplot(x)

## broom zoo to data.frame
ggplot(aes(x = index, y = value), data = broom::tidy(x)) +
  geom_line() + xlab(&amp;quot;Index&amp;quot;) + ylab(&amp;quot;x&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2018-05-10-time-series-analysis-ii-zoo_files/figure-html/unnamed-chunk-8-1.png&#34; width=&#34;960&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>US State and County Choropleth Map (Heatmap)</title>
      <link>/post/us-state-and-county-choropleth-map-heatmap/</link>
      <pubDate>Fri, 04 May 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/us-state-and-county-choropleth-map-heatmap/</guid>
      <description>


&lt;p&gt;In this &lt;a href=&#34;https://twitter.com/search?q=%23TidyTuesday&amp;amp;src=tyah&#34;&gt;#TidyTuesday&lt;/a&gt; post, I try to show an example of putting together six common geographic visualization methods of &lt;a href=&#34;https://en.wikipedia.org/wiki/Heat_map&#34;&gt;&lt;strong&gt;heat map&lt;/strong&gt;&lt;/a&gt; or &lt;a href=&#34;https://en.wikipedia.org/wiki/Choropleth_map&#34;&gt;&lt;strong&gt;choropleth map&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Code is available on &lt;a href=&#34;https://github.com/ChuliangXiao/tidytuesday/tree/master/Week05&#34;&gt;GitHUB&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;Counties
&lt;ul&gt;
&lt;li&gt;Map data from &lt;code&gt;mpas&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/ChuliangXiao/tidytuesday/blob/master/Week05/county_maps.Rmd&#34;&gt;Corrected&lt;/a&gt; to match with American Community Survey (ACS)&lt;br /&gt;
&lt;/li&gt;
&lt;li&gt;COUNS (48 states an DC)&lt;br /&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Map data from &lt;code&gt;albersusa&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;50 States and DC&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Using &lt;code&gt;R6&lt;/code&gt; class &lt;code&gt;choroplethr&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;50 States and DC&lt;br /&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;States
&lt;ul&gt;
&lt;li&gt;Map data from &lt;code&gt;fiftyster&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;50 States and DC&lt;br /&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;State bins from &lt;code&gt;statebins&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;50 States, DC and &lt;strong&gt;PR&lt;/strong&gt;&lt;br /&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;State hexbins from &lt;code&gt;geojsonion&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;50 States and DC&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;div id=&#34;week-5---county-level-american-community-survey-5-year-estimates-2015&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Week 5 - County-level American Community Survey (5-year estimates) 2015&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/rfordatascience/tidytuesday/blob/master/data/acs2015_county_data.csv&#34;&gt;RAW DATA&lt;/a&gt;&lt;br /&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://factfinder.census.gov/faces/nav/jsf/pages/index.xhtml&#34;&gt;DataSource: census.gov&lt;/a&gt;&lt;br /&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.kaggle.com/muonneutrino/us-census-demographic-data&#34;&gt;Kaggle source&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;/div&gt;
&lt;div id=&#34;counties-of-conus-with-data-from-maps&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Counties of &lt;a href=&#34;https://en.wikipedia.org/wiki/Contiguous_United_States&#34;&gt;CONUS&lt;/a&gt; with data from &lt;code&gt;maps&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/ChuliangXiao/tidytuesday/master/Week05/US_State_County_CONUS.png&#34; /&gt;
### Counties of 50 States and DC with data from &lt;code&gt;albersusa&lt;/code&gt;&lt;br /&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/ChuliangXiao/tidytuesday/master/Week05/US_State_County_albers.png&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;counties-of-50-states-and-dc-using-choroplethr&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Counties of 50 States and DC using &lt;code&gt;choroplethr&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/ChuliangXiao/tidytuesday/master/Week05/US_State_County_choropleth.png&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;states-and-dc-using-fiftyster&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;50 States and DC using &lt;code&gt;fiftyster&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/ChuliangXiao/tidytuesday/master/Week05/US_State_State_fiftystater.png&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;bins-of-50-states-dc-and-pr-using-statebins&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Bins of 50 States, DC and PR using &lt;code&gt;statebins&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/ChuliangXiao/tidytuesday/master/Week05/US_State_State_statebins.png&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;hexbins-of-50-states-and-dc-data-from-geojsonion&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Hexbins of 50 States and DC data from &lt;code&gt;geojsonion&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/ChuliangXiao/tidytuesday/master/Week05/US_State_State_geojsonio.png&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Time Series Analysis I: date and time </title>
      <link>/post/time-series-analysis-i-date-and-time/</link>
      <pubDate>Fri, 20 Apr 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/time-series-analysis-i-date-and-time/</guid>
      <description>


&lt;div id=&#34;date-class-from-basedate-and-lubridate&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;&lt;code&gt;Date&lt;/code&gt; class from &lt;code&gt;base::Date&lt;/code&gt; and &lt;code&gt;lubridate&lt;/code&gt;&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;d1 &amp;lt;- Sys.Date()
d1; class(d1)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;2018-09-12&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;Date&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dates &amp;lt;- c(&amp;quot;02/27/92&amp;quot;, &amp;quot;02/27/92&amp;quot;, &amp;quot;01/14/92&amp;quot;)
dd    &amp;lt;- as.Date(dates, &amp;quot;%m/%d/%y&amp;quot;)
dd; class(dd)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;1992-02-27&amp;quot; &amp;quot;1992-02-27&amp;quot; &amp;quot;1992-01-14&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;Date&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;d2 &amp;lt;- lubridate::as_date(&amp;quot;2018-07-05&amp;quot;)
d2; class(d2)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;2018-07-05&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;Date&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;posix-class-from-baseas.posix&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;&lt;code&gt;POSIX*&lt;/code&gt; class from &lt;code&gt;base::as.POSIX*&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;POSIXt&lt;/code&gt; types, &lt;code&gt;POSIXct&lt;/code&gt; and &lt;code&gt;POSIXlt&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ct&lt;/code&gt;, calendar time, stores the number of seconds since the origin&lt;br /&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;lt&lt;/code&gt;, local time, keeps the date as a list of time attributes (such as ”hour” and ”mon”).&lt;br /&gt;
&lt;code&gt;unclass(as.POSIXct(Sys.time()))&lt;/code&gt; vs &lt;code&gt;unclass(as.POSIXlt(Sys.time()))&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dt1 &amp;lt;- as.POSIXct(Sys.time())
dt1; class(dt1)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;2018-09-12 16:31:23 EDT&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;POSIXct&amp;quot; &amp;quot;POSIXt&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dt2 &amp;lt;- lubridate::as_datetime(&amp;quot;2018-07-05 15:30:21&amp;quot;)
dt2; class(dt2)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;2018-07-05 15:30:21 UTC&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;POSIXct&amp;quot; &amp;quot;POSIXt&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;timedate-class-from-timedate&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;&lt;code&gt;timeDate&lt;/code&gt; class from &lt;code&gt;timeDate&lt;/code&gt;&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dts &amp;lt;- c(&amp;quot;1989-09-28&amp;quot;, &amp;quot;2001-01-15&amp;quot;, &amp;quot;2004-08-30&amp;quot;, &amp;quot;1990-02-09&amp;quot;)
tms &amp;lt;- c(  &amp;quot;23:12:55&amp;quot;,   &amp;quot;10:34:02&amp;quot;,   &amp;quot;08:30:00&amp;quot;,   &amp;quot;11:18:23&amp;quot;)
tD1  &amp;lt;- timeDate::timeDate(dts, format = &amp;quot;%Y-%m-%d&amp;quot;, FinCenter = &amp;quot;GMT&amp;quot; )
class(tD1)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;timeDate&amp;quot;
## attr(,&amp;quot;package&amp;quot;)
## [1] &amp;quot;timeDate&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;dates-times-and-chron-class-from-chron&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;&lt;code&gt;dates&lt;/code&gt;, &lt;code&gt;times&lt;/code&gt; and &lt;code&gt;chron&lt;/code&gt; class from &lt;code&gt;chron&lt;/code&gt;&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dts &amp;lt;- chron::dates(c(&amp;quot;02/27/92&amp;quot;, &amp;quot;02/27/92&amp;quot;, &amp;quot;01/14/92&amp;quot;))
dts; class(dts)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 02/27/92 02/27/92 01/14/92&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;dates&amp;quot; &amp;quot;times&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dts &amp;lt;- chron::dates(c(&amp;quot;02/27/92&amp;quot;, &amp;quot;02/27/92&amp;quot;, &amp;quot;01/14/92&amp;quot;))
tms &amp;lt;- chron::times(c(&amp;quot;23:03:20&amp;quot;, &amp;quot;22:29:56&amp;quot;, &amp;quot;01:03:30&amp;quot;))
tms; class(tms)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 23:03:20 22:29:56 01:03:30&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;times&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# [1] 23:03:20 22:29:56 01:03:30 18:21:03 16:56:26
x &amp;lt;- chron::chron(dates = dts, times = tms)
x; class(x)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] (02/27/92 23:03:20) (02/27/92 22:29:56) (01/14/92 01:03:30)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;chron&amp;quot; &amp;quot;dates&amp;quot; &amp;quot;times&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>R Spatial Data Analysis 4: stars</title>
      <link>/post/r-spatial-data-analysis-4-stars/</link>
      <pubDate>Fri, 06 Apr 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/r-spatial-data-analysis-4-stars/</guid>
      <description>


&lt;p&gt;&lt;a href=&#34;https://www.r-spatial.org/r/2018/03/22/stars2.html&#34; class=&#34;uri&#34;&gt;https://www.r-spatial.org/r/2018/03/22/stars2.html&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>R Spatial Data Analysis 3: Simple Features </title>
      <link>/post/r-spatial-data-analysis-3-simple-features/</link>
      <pubDate>Wed, 04 Apr 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/r-spatial-data-analysis-3-simple-features/</guid>
      <description>


&lt;p&gt;&lt;a href=&#34;https://www.r-spatial.org/r/2016/02/15/simple-features-for-r.html&#34; class=&#34;uri&#34;&gt;https://www.r-spatial.org/r/2016/02/15/simple-features-for-r.html&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>R Spatial Data Analysis 2: Spatial Class</title>
      <link>/post/r-spatial-data-analysis-2-spatial-class/</link>
      <pubDate>Mon, 02 Apr 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/r-spatial-data-analysis-2-spatial-class/</guid>
      <description>


&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(sp)&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;getClass(&amp;#39;Spatial&amp;#39;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Class &amp;quot;Spatial&amp;quot; [package &amp;quot;sp&amp;quot;]
## 
## Slots:
##                               
## Name:         bbox proj4string
## Class:      matrix         CRS
## 
## Known Subclasses: 
## Class &amp;quot;SpatialPoints&amp;quot;, directly
## Class &amp;quot;SpatialMultiPoints&amp;quot;, directly
## Class &amp;quot;SpatialGrid&amp;quot;, directly
## Class &amp;quot;SpatialLines&amp;quot;, directly
## Class &amp;quot;SpatialPolygons&amp;quot;, directly
## Class &amp;quot;SpatialPointsDataFrame&amp;quot;, by class &amp;quot;SpatialPoints&amp;quot;, distance 2
## Class &amp;quot;SpatialPixels&amp;quot;, by class &amp;quot;SpatialPoints&amp;quot;, distance 2
## Class &amp;quot;SpatialMultiPointsDataFrame&amp;quot;, by class &amp;quot;SpatialMultiPoints&amp;quot;, distance 2
## Class &amp;quot;SpatialGridDataFrame&amp;quot;, by class &amp;quot;SpatialGrid&amp;quot;, distance 2
## Class &amp;quot;SpatialLinesDataFrame&amp;quot;, by class &amp;quot;SpatialLines&amp;quot;, distance 2
## Class &amp;quot;SpatialPixelsDataFrame&amp;quot;, by class &amp;quot;SpatialPoints&amp;quot;, distance 3
## Class &amp;quot;SpatialPolygonsDataFrame&amp;quot;, by class &amp;quot;SpatialPolygons&amp;quot;, distance 2&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;shape-objects&#34; class=&#34;section level5&#34;&gt;
&lt;h5&gt;Shape objects&lt;/h5&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr class=&#34;header&#34;&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;Without data&lt;/th&gt;
&lt;th&gt;With data&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td&gt;Polygons&lt;/td&gt;
&lt;td&gt;SpatialPolygons&lt;/td&gt;
&lt;td&gt;SpatialPolygonsDataFrame&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td&gt;Points&lt;/td&gt;
&lt;td&gt;SpatialPoints&lt;/td&gt;
&lt;td&gt;SpatialPointsDataFrame&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td&gt;Lines&lt;/td&gt;
&lt;td&gt;SpatialLines&lt;/td&gt;
&lt;td&gt;SpatialLinesDataFrame&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td&gt;Raster&lt;/td&gt;
&lt;td&gt;SpatialGrid&lt;/td&gt;
&lt;td&gt;SpatialGridDataFrame&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td&gt;Raster&lt;/td&gt;
&lt;td&gt;SpatialPixels&lt;/td&gt;
&lt;td&gt;SpatialPixelsDataFrame&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td&gt;Raster&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;RasterLayer&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td&gt;Raster&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;RasterBrick&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td&gt;Raster&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;RasterStack&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>R Spatial Data Analysis 1: from Data to Spatial Data</title>
      <link>/post/r-spatial-data-analysis-1-from-data-to-spatial-data/</link>
      <pubDate>Sat, 31 Mar 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/r-spatial-data-analysis-1-from-data-to-spatial-data/</guid>
      <description>


&lt;p&gt;As much as R is popular in data analysis, R becomes more and more favored in geospatial analysis and visualization.&lt;/p&gt;
&lt;p&gt;To introduce spatial data, let first start with comman data. Basic R data types: &lt;code&gt;vector&lt;/code&gt;, &lt;code&gt;factor&lt;/code&gt;, &lt;code&gt;matrix&lt;/code&gt;, &lt;code&gt;data.frame&lt;/code&gt;, and &lt;code&gt;list&lt;/code&gt;.&lt;/p&gt;
&lt;div id=&#34;data-and-plots&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Data and Plots&lt;/h3&gt;
&lt;p&gt;There are many ways to munipulate and visualize data in R, including, typically, the basic and the &lt;code&gt;tidyverse&lt;/code&gt; framework. Let’s warm up with plotting &lt;code&gt;data.frame&lt;/code&gt;.&lt;/p&gt;
&lt;div id=&#34;basic-plot&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;basic plot&lt;/h4&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;attach(mtcars)
par(mfrow = c(1,2))
plot(mpg, wt, main = &amp;quot;wt vs. mpg&amp;quot;)
hist(mpg)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2018-03-31-r-spatial-data-analysis-1-from-data-to-spatial-data_files/figure-html/unnamed-chunk-1-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;ggplot2&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;ggplot2&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(ggplot2)
p1  &amp;lt;- ggplot(mtcars, aes(x = mpg, y = wt)) + 
  geom_point() +
  ggtitle(&amp;quot;wt vs. mpg&amp;quot;) +
  theme(plot.title = element_text(hjust = 0.5))
p2  &amp;lt;- ggplot(mtcars, aes(mpg)) +
  geom_histogram(binwidth = 5, color = &amp;#39;black&amp;#39;, fill = &amp;#39;white&amp;#39;) +
  ggtitle(&amp;quot;mpg Histogram&amp;quot;) +
  theme(plot.title = element_text(hjust = 0.5))  
library(grid)
library(gridExtra)
grid.arrange(p1, p2, ncol = 2)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2018-03-31-r-spatial-data-analysis-1-from-data-to-spatial-data_files/figure-html/unnamed-chunk-2-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;div id=&#34;spatial-data-and-plots&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;Spatial Data and Plots&lt;/h4&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# Load a csv file as data.frame as usual
dfUS &amp;lt;- read.csv(&amp;quot;/Users/cxiao/Documents/Rmd/Station_US.csv&amp;quot;)
# Take a look at the data.frame
head(dfUS)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##   Num Station      Lat       Lon Avail
## 1   1 4074950 45.19133 -88.73779     1
## 2   2 4177720 41.52899 -84.88253     1
## 3   3 4077630 44.89831 -88.84534     1
## 4   4 4109000 42.29428 -84.40427     1
## 5   5 4178000 41.38407 -84.80254     1
## 6   6 4180988 40.70275 -84.65022     1&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# A bounch of USGS gages with lations
dfUS$Station  &amp;lt;- paste0(&amp;quot;0&amp;quot;, dfUS$Station)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;How to transfer a data.frame to a spatial class?&lt;/p&gt;
&lt;div id=&#34;first-get-the-coordinates&#34; class=&#34;section level5&#34;&gt;
&lt;h5&gt;First, get the coordinates&lt;/h5&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(sp)
coords  &amp;lt;- SpatialPoints(dfUS[, c(&amp;#39;Lon&amp;#39;, &amp;#39;Lat&amp;#39;)])&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Let’s check the above variable&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;class(coords)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;SpatialPoints&amp;quot;
## attr(,&amp;quot;package&amp;quot;)
## [1] &amp;quot;sp&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str(coords)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Formal class &amp;#39;SpatialPoints&amp;#39; [package &amp;quot;sp&amp;quot;] with 3 slots
##   ..@ coords     : num [1:392, 1:2] -88.7 -84.9 -88.8 -84.4 -84.8 ...
##   .. ..- attr(*, &amp;quot;dimnames&amp;quot;)=List of 2
##   .. .. ..$ : NULL
##   .. .. ..$ : chr [1:2] &amp;quot;Lon&amp;quot; &amp;quot;Lat&amp;quot;
##   ..@ bbox       : num [1:2, 1:2] -92.6 40.7 -74.5 47.5
##   .. ..- attr(*, &amp;quot;dimnames&amp;quot;)=List of 2
##   .. .. ..$ : chr [1:2] &amp;quot;Lon&amp;quot; &amp;quot;Lat&amp;quot;
##   .. .. ..$ : chr [1:2] &amp;quot;min&amp;quot; &amp;quot;max&amp;quot;
##   ..@ proj4string:Formal class &amp;#39;CRS&amp;#39; [package &amp;quot;sp&amp;quot;] with 1 slot
##   .. .. ..@ projargs: chr NA&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;head(coords)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## SpatialPoints:
##            Lon      Lat
## [1,] -88.73779 45.19133
## [2,] -84.88253 41.52899
## [3,] -88.84534 44.89831
## [4,] -84.40427 42.29428
## [5,] -84.80254 41.38407
## [6,] -84.65022 40.70275
## Coordinate Reference System (CRS) arguments: NA&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We can see, it’s a SpatialPoints class, looking like data.frame, only with coordinates but with any meaningful data.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;second-assign-data-to-the-spatialpoints&#34; class=&#34;section level5&#34;&gt;
&lt;h5&gt;Second, assign data to the SpatialPoints&lt;/h5&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;spUS  &amp;lt;- SpatialPointsDataFrame(coords, dfUS)
# Check the new variable
class(spUS)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;SpatialPointsDataFrame&amp;quot;
## attr(,&amp;quot;package&amp;quot;)
## [1] &amp;quot;sp&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str(spUS)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Formal class &amp;#39;SpatialPointsDataFrame&amp;#39; [package &amp;quot;sp&amp;quot;] with 5 slots
##   ..@ data       :&amp;#39;data.frame&amp;#39;:  392 obs. of  5 variables:
##   .. ..$ Num    : int [1:392] 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ Station: chr [1:392] &amp;quot;04074950&amp;quot; &amp;quot;04177720&amp;quot; &amp;quot;04077630&amp;quot; &amp;quot;04109000&amp;quot; ...
##   .. ..$ Lat    : num [1:392] 45.2 41.5 44.9 42.3 41.4 ...
##   .. ..$ Lon    : num [1:392] -88.7 -84.9 -88.8 -84.4 -84.8 ...
##   .. ..$ Avail  : int [1:392] 1 1 1 1 1 1 1 1 1 1 ...
##   ..@ coords.nrs : num(0) 
##   ..@ coords     : num [1:392, 1:2] -88.7 -84.9 -88.8 -84.4 -84.8 ...
##   .. ..- attr(*, &amp;quot;dimnames&amp;quot;)=List of 2
##   .. .. ..$ : NULL
##   .. .. ..$ : chr [1:2] &amp;quot;Lon&amp;quot; &amp;quot;Lat&amp;quot;
##   ..@ bbox       : num [1:2, 1:2] -92.6 40.7 -74.5 47.5
##   .. ..- attr(*, &amp;quot;dimnames&amp;quot;)=List of 2
##   .. .. ..$ : chr [1:2] &amp;quot;Lon&amp;quot; &amp;quot;Lat&amp;quot;
##   .. .. ..$ : chr [1:2] &amp;quot;min&amp;quot; &amp;quot;max&amp;quot;
##   ..@ proj4string:Formal class &amp;#39;CRS&amp;#39; [package &amp;quot;sp&amp;quot;] with 1 slot
##   .. .. ..@ projargs: chr NA&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(spUS)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2018-03-31-r-spatial-data-analysis-1-from-data-to-spatial-data_files/figure-html/unnamed-chunk-6-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;after-tmap-is-loaded&#34; class=&#34;section level5&#34;&gt;
&lt;h5&gt;After &lt;code&gt;tmap&lt;/code&gt; is loaded&lt;/h5&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(tmap)
spUS&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## class       : SpatialPointsDataFrame 
## features    : 392 
## extent      : -92.63297, -74.54355, 40.70275, 47.48204  (xmin, xmax, ymin, ymax)
## coord. ref. : NA 
## variables   : 5
## names       : Num,          Station,      Lat,       Lon, Avail 
## min values  :   1,         04015330, 40.70275, -74.54355,     0 
## max values  : 392, 0441624088045601, 47.48204, -92.63297,     1&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;A Spatial class variable will not be entirely dumped out.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# try tmap::qtm
qtm(spUS)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2018-03-31-r-spatial-data-analysis-1-from-data-to-spatial-data_files/figure-html/unnamed-chunk-8-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;difference-between-data.frame-and-spatialpointsdataframe&#34; class=&#34;section level5&#34;&gt;
&lt;h5&gt;Difference between &lt;code&gt;data.frame&lt;/code&gt; and &lt;code&gt;SpatialPointsDataFrame&lt;/code&gt;&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;data.frame&lt;/code&gt; uses &lt;code&gt;$&lt;/code&gt; to access its columns.
&lt;ul&gt;
&lt;li&gt;e.g. &lt;code&gt;dfUS$Station&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SpatialPointsDataFrame&lt;/code&gt; uses &lt;code&gt;@&lt;/code&gt; to access its four lists: &lt;code&gt;data&lt;/code&gt;, &lt;code&gt;coords.nrs&lt;/code&gt;, &lt;code&gt;coords&lt;/code&gt;, &lt;code&gt;bbox&lt;/code&gt; and &lt;code&gt;proj4string&lt;/code&gt;; while &lt;code&gt;$&lt;/code&gt; to its &lt;code&gt;data&lt;/code&gt; columns.
&lt;ul&gt;
&lt;li&gt;e.g. &lt;code&gt;spUS@data&lt;/code&gt;, then &lt;code&gt;spUS@data$Station&lt;/code&gt;, or simply &lt;code&gt;spUS$Station&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div id=&#34;another-quick-way&#34; class=&#34;section level5&#34;&gt;
&lt;h5&gt;Another quick way&lt;/h5&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;pnt1  &amp;lt;- dfUS
coordinates(pnt1) = ~ Lon + Lat&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;shape-objects&#34; class=&#34;section level5&#34;&gt;
&lt;h5&gt;Shape objects&lt;/h5&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr class=&#34;header&#34;&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;Without data&lt;/th&gt;
&lt;th&gt;With data&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td&gt;Polygons&lt;/td&gt;
&lt;td&gt;SpatialPolygons&lt;/td&gt;
&lt;td&gt;SpatialPolygonsDataFrame&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td&gt;Points&lt;/td&gt;
&lt;td&gt;SpatialPoints&lt;/td&gt;
&lt;td&gt;SpatialPointsDataFrame&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td&gt;Lines&lt;/td&gt;
&lt;td&gt;SpatialLines&lt;/td&gt;
&lt;td&gt;SpatialLinesDataFrame&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td&gt;Raster&lt;/td&gt;
&lt;td&gt;SpatialGrid&lt;/td&gt;
&lt;td&gt;SpatialGridDataFrame&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td&gt;Raster&lt;/td&gt;
&lt;td&gt;SpatialPixels&lt;/td&gt;
&lt;td&gt;SpatialPixelsDataFrame&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td&gt;Raster&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;RasterLayer&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td&gt;Raster&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;RasterBrick&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td&gt;Raster&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;RasterStack&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;reading&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Reading&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Tutorial: &lt;a href=&#34;https://github.com/Robinlovelace/Creating-maps-in-R&#34;&gt;Creating maps in R&lt;/a&gt; by Robin Lovelance and James Cheshire&lt;/li&gt;
&lt;li&gt;website &lt;a href=&#34;https://www.r-spatial.org&#34;&gt;r-spaital.org&lt;/a&gt; by Edzer Pebesma&lt;br /&gt;
&lt;/li&gt;
&lt;li&gt;CRAN Task View: &lt;a href=&#34;https://CRAN.R-project.org/view=Spatial&#34;&gt;Analysis of Spatial Data&lt;/a&gt; by Roger Bivand&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div id=&#34;packages&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Packages&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;rgdal&lt;/code&gt;: R’s interface to Geospatial Data Abstraction Library (GDAL)
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;rgdal::readOGR&lt;/code&gt;, to read OGR vector maps (e.g. shapfile) into Spatial objects&lt;br /&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;rgeos&lt;/code&gt;: R’s interface to the powerful vector processing library geos&lt;br /&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;maptools&lt;/code&gt;: provides various mapping functions&lt;br /&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tmap&lt;/code&gt;: a new packages for rapidly creating beautiful maps
&lt;ul&gt;
&lt;li&gt;An extenstion wrap of the basic &lt;code&gt;plot&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;qtm&lt;/code&gt;, quick thematic map plot&lt;br /&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tm_shape&lt;/code&gt;, &lt;code&gt;tm_fill&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ggmap&lt;/code&gt;: extends the plotting package &lt;code&gt;ggplot2&lt;/code&gt; for maps
&lt;ul&gt;
&lt;li&gt;add a variaty of basemaps&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;leaflet&lt;/code&gt;: interactive map from its &lt;a href=&#34;http://leafletjs.com/&#34;&gt;JavaScript&lt;/a&gt;&lt;br /&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;mapview&lt;/code&gt;: interactive viewing spatial data based on &lt;code&gt;leaflet&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;Personally I like &lt;code&gt;mapview&lt;/code&gt;’s popup function, see &lt;a href=&#34;https://r-spatial.github.io/mapview/&#34;&gt;tutorial&lt;/a&gt;&lt;br /&gt;
&lt;/li&gt;
&lt;li&gt;It spports &lt;code&gt;sp&lt;/code&gt;, &lt;code&gt;raster&lt;/code&gt;, &lt;code&gt;sf&lt;/code&gt; and &lt;a href=&#34;https://cran.r-project.org/package=satellite&#34;&gt;&lt;code&gt;satellite&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div id=&#34;maptoolsreadshapespatial&#34; class=&#34;section level5&#34;&gt;
&lt;h5&gt;maptools::readShapeSpatial&lt;/h5&gt;
&lt;blockquote&gt;
&lt;p&gt;The use of &lt;code&gt;maptools::readShapeSpatial&lt;/code&gt; has been &lt;strong&gt;deprecated&lt;/strong&gt;. Use &lt;code&gt;rgdal::readOGR&lt;/code&gt; and &lt;code&gt;sf::st_read&lt;/code&gt; instead.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;beyond-sp-package&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Beyond &lt;code&gt;sp&lt;/code&gt; package&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;sf&lt;/code&gt; &lt;a href=&#34;../r-spatial-data-analysis-3-simple-features&#34;&gt;simple feature package&lt;/a&gt;&lt;br /&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;star&lt;/code&gt; &lt;a href=&#34;../r-spatial-data-analysis-4-stars&#34;&gt;spatiotemporal didy arrays for R&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Comparison: sort, order and arrange</title>
      <link>/post/comparison-sort-order-and-arrange/</link>
      <pubDate>Wed, 28 Mar 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/comparison-sort-order-and-arrange/</guid>
      <description>


&lt;ul&gt;
&lt;li&gt;&lt;h2 id=&#34;vector-or-factor&#34;&gt;&lt;strong&gt;vector&lt;/strong&gt; (or factor)&lt;/h2&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;(x &amp;lt;- swiss$Education[1:20])&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  [1] 12  9  5  7 15  7  7  8  7 13  6 12  7 12  5  2  8 28 20  9&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# sort the vector
sort(x)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  [1]  2  5  5  6  7  7  7  7  7  8  8  9  9 12 12 12 13 15 20 28&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# partial sorting
sort(x, partial = c(10, 15))&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  [1]  2  5  5  7  7  7  7  6  7  8  8  9  9 12 12 12 13 28 20 15&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Partial sorting in R is different with that in &lt;a href=&#34;http://en.wikipedia.org/wiki/Partial_sorting&#34;&gt;Wikipedia&lt;/a&gt;. See &lt;a href=&#34;https://stackoverflow.com/a/23579512&#34;&gt;Stack Overflow&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;h2 id=&#34;data.frame&#34;&gt;&lt;strong&gt;data.frame&lt;/strong&gt;&lt;/h2&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;order&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;head(mtcars)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# sort by mpg
Rank1 &amp;lt;- mtcars[order(mtcars$mpg), ]
head(Rank1)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##                      mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Cadillac Fleetwood  10.4   8  472 205 2.93 5.250 17.98  0  0    3    4
## Lincoln Continental 10.4   8  460 215 3.00 5.424 17.82  0  0    3    4
## Camaro Z28          13.3   8  350 245 3.73 3.840 15.41  0  0    3    4
## Duster 360          14.3   8  360 245 3.21 3.570 15.84  0  0    3    4
## Chrysler Imperial   14.7   8  440 230 3.23 5.345 17.42  0  0    3    4
## Maserati Bora       15.0   8  301 335 3.54 3.570 14.60  0  1    5    8&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# sort by cyl, then by hp
Rank2 &amp;lt;- mtcars[order(mtcars$cyl, mtcars$hp), ]
head(Rank2)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##                 mpg cyl  disp hp drat    wt  qsec vs am gear carb
## Honda Civic    30.4   4  75.7 52 4.93 1.615 18.52  1  1    4    2
## Merc 240D      24.4   4 146.7 62 3.69 3.190 20.00  1  0    4    2
## Toyota Corolla 33.9   4  71.1 65 4.22 1.835 19.90  1  1    4    1
## Fiat 128       32.4   4  78.7 66 4.08 2.200 19.47  1  1    4    1
## Fiat X1-9      27.3   4  79.0 66 4.08 1.935 18.90  1  1    4    1
## Porsche 914-2  26.0   4 120.3 91 4.43 2.140 16.70  0  1    5    2&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# reverse sort
Rank3 &amp;lt;- mtcars[order(-mtcars$cyl, mtcars$hp), ]
head(Rank3)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##                    mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Dodge Challenger  15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2
## AMC Javelin       15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2
## Hornet Sportabout 18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
## Pontiac Firebird  19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2
## Merc 450SE        16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3
## Merc 450SL        17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If data.frame mtcars is &lt;code&gt;attach()&lt;/code&gt;, then&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;attach(mtcars)
mpgRank &amp;lt;- mtcars[order(mpg), ]
head(mpgRank)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##                      mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Cadillac Fleetwood  10.4   8  472 205 2.93 5.250 17.98  0  0    3    4
## Lincoln Continental 10.4   8  460 215 3.00 5.424 17.82  0  0    3    4
## Camaro Z28          13.3   8  350 245 3.73 3.840 15.41  0  0    3    4
## Duster 360          14.3   8  360 245 3.21 3.570 15.84  0  0    3    4
## Chrysler Imperial   14.7   8  440 230 3.23 5.345 17.42  0  0    3    4
## Maserati Bora       15.0   8  301 335 3.54 3.570 14.60  0  1    5    8&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;2&#34; style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;dplyr::arrange&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(dplyr)&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;Rank4 &amp;lt;- arrange(mtcars, mpg)
head(Rank4)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## 1 10.4   8  472 205 2.93 5.250 17.98  0  0    3    4
## 2 10.4   8  460 215 3.00 5.424 17.82  0  0    3    4
## 3 13.3   8  350 245 3.73 3.840 15.41  0  0    3    4
## 4 14.3   8  360 245 3.21 3.570 15.84  0  0    3    4
## 5 14.7   8  440 230 3.23 5.345 17.42  0  0    3    4
## 6 15.0   8  301 335 3.54 3.570 14.60  0  1    5    8&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;Rank5 &amp;lt;- arrange(mtcars, cyl, hp)
head(Rank5)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    mpg cyl  disp hp drat    wt  qsec vs am gear carb
## 1 30.4   4  75.7 52 4.93 1.615 18.52  1  1    4    2
## 2 24.4   4 146.7 62 3.69 3.190 20.00  1  0    4    2
## 3 33.9   4  71.1 65 4.22 1.835 19.90  1  1    4    1
## 4 32.4   4  78.7 66 4.08 2.200 19.47  1  1    4    1
## 5 27.3   4  79.0 66 4.08 1.935 18.90  1  1    4    1
## 6 26.0   4 120.3 91 4.43 2.140 16.70  0  1    5    2&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;Rank6 &amp;lt;- arrange(mtcars, -cyl, hp)
head(Rank6)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## 1 15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2
## 2 15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2
## 3 18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
## 4 19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2
## 5 16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3
## 6 17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;3&#34; style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;difference between order and arrange
&lt;ul&gt;
&lt;li&gt;row names: &lt;code&gt;order&lt;/code&gt; keep the row names of mtcars, while not in &lt;code&gt;dplyr::arrange&lt;/code&gt;&lt;br /&gt;
&lt;/li&gt;
&lt;li&gt;efficency: &lt;code&gt;dplyr::arrange&lt;/code&gt; tends to be faster when there are lots of rows.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Refer to&lt;br /&gt;
1. &lt;a href=&#34;http://www.cookbook-r.com/Manipulating_data/Sorting/&#34;&gt;Cookbook for R&lt;/a&gt;&lt;br /&gt;
2. &lt;a href=&#34;https://www.statmethods.net/management/sorting.html&#34;&gt;Quick-R&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Comparison: transform, within and mutate</title>
      <link>/post/comparison-transform-within-and-mutate/</link>
      <pubDate>Sun, 25 Mar 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/comparison-transform-within-and-mutate/</guid>
      <description>


&lt;p&gt;Here is another comparison between two basic functions &lt;code&gt;transform&lt;/code&gt; and &lt;code&gt;within&lt;/code&gt;, and a tidyverse function &lt;code&gt;dplyr::mutate&lt;/code&gt;. They all can be used for data munipulation, adding a new column to a data.frame.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;head(mtcars)  &lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;one-variable&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;One variable&lt;/h3&gt;
&lt;p&gt;Calculate horse power per cylinder (&lt;code&gt;hp/cyl&lt;/code&gt;) and add it to &lt;code&gt;mtcars&lt;/code&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;tmp1  &amp;lt;- transform(mtcars, hpc = round(hp / cyl))
head(tmp1)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb hpc
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4  18
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4  18
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1  23
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1  18
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2  22
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1  18&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;tmp2 &amp;lt;- within(mtcars, {hpc &amp;lt;- round(hp / cyl)})
# tmp1 and tmp2 are identicial
head(tmp2)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb hpc
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4  18
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4  18
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1  23
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1  18
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2  22
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1  18&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(dplyr)
tmp3 &amp;lt;- mutate(mtcars, hpc = round(hp / cyl))
# tmp3 is ALMOST the same as tmp1 and tmp2, except that row names are missed
head(tmp3)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    mpg cyl disp  hp drat    wt  qsec vs am gear carb hpc
## 1 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4  18
## 2 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4  18
## 3 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1  23
## 4 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1  18
## 5 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2  22
## 6 18.1   6  225 105 2.76 3.460 20.22  1  0    3    1  18&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;two-variables&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;two variables&lt;/h3&gt;
&lt;p&gt;A variable created by &lt;code&gt;transform&lt;/code&gt; process cannot be used&lt;a href=&#34;#fn1&#34; class=&#34;footnoteRef&#34; id=&#34;fnref1&#34;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt;.&lt;br /&gt;
The example below fails.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;tmp1  &amp;lt;- transform(mtcars, hpc = round(hp / cyl), hpc1 = hpc + 1)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;While &lt;code&gt;within&lt;/code&gt; and &lt;code&gt;dplyr::mutate&lt;/code&gt; are OK&lt;a href=&#34;#fn2&#34; class=&#34;footnoteRef&#34; id=&#34;fnref2&#34;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;tmp2 &amp;lt;- within(mtcars, {hpc  &amp;lt;- round(hp / cyl)
                        hpc1 &amp;lt;- hpc + 1 })
head(tmp2)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb hpc1
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4   19
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4   19
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1   24
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1   19
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2   23
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1   19
##                   hpc
## Mazda RX4          18
## Mazda RX4 Wag      18
## Datsun 710         23
## Hornet 4 Drive     18
## Hornet Sportabout  22
## Valiant            18&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;tmp3 &amp;lt;- mutate(mtcars, hpc = round(hp / cyl), hpc1 = hpc + 1)
head(tmp3)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    mpg cyl disp  hp drat    wt  qsec vs am gear carb hpc hpc1
## 1 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4  18   19
## 2 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4  18   19
## 3 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1  23   24
## 4 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1  18   19
## 5 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2  22   23
## 6 18.1   6  225 105 2.76 3.460 20.22  1  0    3    1  18   19&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div class=&#34;footnotes&#34;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&#34;fn1&#34;&gt;&lt;p&gt;What is the difference between &lt;code&gt;transform&lt;/code&gt; and &lt;code&gt;within&lt;/code&gt; &lt;a href=&#34;https://stackoverflow.com/a/22417775&#34;&gt;Stack Overflow&lt;/a&gt;&lt;a href=&#34;#fnref1&#34;&gt;↩&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&#34;fn2&#34;&gt;&lt;p&gt;&lt;a href=&#34;http://rstudio-pubs-static.s3.amazonaws.com/1053_c089bd9190624b37b1180b91d2776e10.html&#34;&gt;Data manipulation using transform(), within(), or plyr::mutate()&lt;/a&gt;&lt;a href=&#34;#fnref2&#34;&gt;↩&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</description>
    </item>
    
  </channel>
</rss>
